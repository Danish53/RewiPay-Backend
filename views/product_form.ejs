<h1 class="mb-4" style="font-size: 26px; font-weight: 700;">
    <%= product ? 'Edit Product' : 'Add Product' %>
</h1>

<form id="productForm" 
      action="<%= action %>" 
      method="POST" 
      enctype="multipart/form-data">

    <div class="row g-3">

        <!-- NAME -->
        <div class="col-md-6">
            <label class="form-label">Name *</label>
            <input name="name" 
                   value="<%= product?.name || '' %>" 
                   class="form-control required-field" />
            <small class="text-danger error-msg"></small>
        </div>

        <!-- BRAND -->
        <div class="col-md-6">
            <label class="form-label">Brand *</label>
            <input name="brand" 
                   value="<%= product?.brand || '' %>" 
                   class="form-control required-field" />
            <small class="text-danger error-msg"></small>
        </div>

        <!-- SHORT DESC -->
        <div class="col-12">
            <label class="form-label">Short Description *</label>
            <input name="description" 
                   value="<%= product?.description || '' %>" 
                   class="form-control required-field" />
            <small class="text-danger error-msg"></small>
        </div>

        <!-- FULL DESC -->
        <div class="col-12">
            <label class="form-label">Full Description *</label>
            <textarea name="fullDescription" rows="4"
                      class="form-control required-field"><%= product?.fullDescription || '' %></textarea>
            <small class="text-danger error-msg"></small>
        </div>

        <!-- PRICE FIELDS -->
        <div class="col-md-3">
            <label class="form-label">Original Price *</label>
            <input type="number" name="originalPrice" 
                   value="<%= product?.originalPrice || '' %>" 
                   class="form-control required-field" />
            <small class="text-danger error-msg"></small>
        </div>

        <div class="col-md-3">
            <label class="form-label">Price *</label>
            <input type="number" name="price" 
                   value="<%= product?.price || '' %>" 
                   class="form-control required-field" />
            <small class="text-danger error-msg"></small>
        </div>

        <div class="col-md-3">
            <label class="form-label">Discount (%)</label>
            <input type="number" name="discount"
                   value="<%= product?.discount || 0 %>" 
                   class="form-control" />
        </div>

        <div class="col-md-3">
            <label class="form-label">Category *</label>
            <input name="category"
                   value="<%= product?.category || '' %>" 
                   class="form-control required-field" />
            <small class="text-danger error-msg"></small>
        </div>

        <!-- FILE UPLOAD -->
        <div class="col-md-4">
            <label class="form-label">Main Image (File)</label>
            <input type="file" name="image" class="form-control" accept="image/*" />
            <% if(product?.image){ %>
                <small>Current: <%= product.image %></small>
            <% } %>
        </div>

        <div class="col-md-8">
            <label class="form-label">Upload Multiple Images</label>
            <input type="file" name="images" class="form-control" accept="image/*" multiple />
            <% if(product?.images){ %>
                <small>Existing: <%= product.images.join(', ') %></small>
            <% } %>
        </div>

        <!-- FEATURES -->
        <div class="col-md-6">
            <label class="form-label">Features (comma separated) *</label>
            <input name="features" 
                   value="<%= product?.features?.join(',') || '' %>" 
                   class="form-control required-field" />
            <small class="text-danger error-msg"></small>
        </div>

        <!-- STOCK -->
        <div class="col-md-2 d-flex align-items-center">
            <div class="form-check mt-3">
                <input class="form-check-input" type="checkbox" name="inStock" value="true"
                    <%= product?.inStock ? 'checked' : '' %> />
                <label class="form-check-label">In Stock</label>
            </div>
        </div>

        <!-- BUTTONS -->
        <div class="col-12">
            <button class="btn btn-success">Save</button>
            <a href="/admin/products" class="btn btn-secondary">Cancel</a>
        </div>

    </div>
</form>

<script>
/* ============================
   REAL-TIME VALIDATION
============================ */
document.getElementById('productForm').addEventListener('submit', function (e) {
    let isValid = true;

    document.querySelectorAll(".required-field").forEach(input => {
        const error = input.nextElementSibling;
        if (input.value.trim() === "") {
            input.style.border = "2px solid red";
            error.innerText = "This field is required";
            isValid = false;
        } else {
            input.style.border = "";
            error.innerText = "";
        }
    });

    if (!isValid) {
        e.preventDefault();
        alert("Please fill all required fields!");
    }

    // Handle false checkbox submit
    const inStock = this.querySelector('input[name="inStock"]');
    if (!inStock.checked) {
        const hidden = document.createElement('input');
        hidden.type = 'hidden';
        hidden.name = 'inStock';
        hidden.value = 'false';
        this.appendChild(hidden);
    }
});
</script>
